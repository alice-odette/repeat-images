(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{7541:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return $}});var n=r(5893),a=r(6265),i=r(809),o=r.n(i),s=r(2447),u=r(7294),f=r(4121),c=r(4047),l=r(2700),h=r(4706),m=r(8127),y=r(4102),g=r(775),v=function(){function e(t,r,n){(0,c.Z)(this,e),(0,a.Z)(this,"bImage",void 0),(0,a.Z)(this,"x",void 0),(0,a.Z)(this,"y",void 0),(0,a.Z)(this,"x2",void 0),(0,a.Z)(this,"y2",void 0),this.bImage=t,this.x=0,this.y=0,this.x2=0,this.y2=0,"number"===typeof r&&"number"===typeof n?(this.x=r,this.y=n):r instanceof e&&this.setCoordinateFromBModule(r),t.image&&(this.x2=this.x+t.image.width,this.y2=this.y+t.image.height)}return(0,l.Z)(e,[{key:"setCoordinateFromBModule",value:function(e){if(void 0!==this.bImage.relative){var t=this.bImage.relative.get(e.bImage.name);t&&(this.x=e.x+t.x,this.y=e.y+t.y)}}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}}]),e}();function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,g.Z)(e);if(t){var a=(0,g.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,y.Z)(this,r)}}var p=function(){function e(t){(0,c.Z)(this,e),this.ml=t,(0,a.Z)(this,"name",void 0),(0,a.Z)(this,"isBase",void 0),this.name=t.name}return(0,l.Z)(e,[{key:"getBImageName",value:function(e,t){if(this.ml.image)return this.ml.image;if(this.ml.images){if(Array.isArray(this.ml.images))return e<this.ml.images.length?this.ml.images[e]:this.ml.images[this.ml.images.length-1];if(this.ml.images)return 0===e&&this.ml.images.first?this.ml.images.first:e===t-1&&this.ml.images.last?this.ml.images.last:this.ml.images.remains}throw new Error("can not find image configs for layer ".concat(this.ml.name))}}],[{key:"from",value:function(e){switch(e.mode){case"base":return new b(e);case"decorate":return new x(e);case"repeat":return new I(e);default:return new Z(e)}}}]),e}(),b=function(e){(0,m.Z)(r,e);var t=d(r);function r(){var e;(0,c.Z)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),(0,a.Z)((0,h.Z)(e),"isBase",!0),e}return(0,l.Z)(r,[{key:"buildLayer",value:function(e,t){for(var r=this.getBImageName(0,t),n=[new v(e.getImageByName(r))],a=1;a<t;a++){var i=this.getBImageName(a,t);n.push(new v(e.getImageByName(i),n[a-1]))}return n}}]),r}(p),w=function(e){(0,m.Z)(r,e);var t=d(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,a.Z)((0,h.Z)(n),"isBase",!1),(0,a.Z)((0,h.Z)(n),"range",void 0),(0,a.Z)((0,h.Z)(n),"dependentLayerName",void 0),n.dependentLayerName=e.fromLayer,n.range=e.range?e.range:[],n}return(0,l.Z)(r,[{key:"getDependentLayerName",value:function(e){return this.dependentLayerName?this.dependentLayerName:e.baseLayerName}},{key:"getDependentLayer",value:function(e){return e.resolveLayer(this.getDependentLayerName(e))}},{key:"getDependentLayerIndices",value:function(e){var t=this.getDependentLayer(e);if(0===this.range.length)return[0,t.length];if(1===this.range.length){var r=this.getIndex(e,this.range[0]);return[r,r+1]}return[this.getIndex(e,this.range[0]),this.getIndex(e,this.range[1])]}},{key:"getIndex",value:function(e,t){var r=this.getDependentLayer(e);return t<0?r.length+t:t}}]),r}(p),Z=function(e){(0,m.Z)(r,e);var t=d(r);function r(){return(0,c.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"buildLayer",value:function(e,t){if(0===t)return[];for(var r=[],n=this.getDependentLayerIndices(e),a=(0,f.Z)(n,2),i=a[0],o=a[1],s=this.getDependentLayer(e),u=i;u<o;u++){var c=this.getBImageName(0,t),l=new v(e.getImageByName(c),s[u]);r.push(l)}return r}}]),r}(w),x=function(e){(0,m.Z)(r,e);var t=d(r);function r(){return(0,c.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"buildLayer",value:function(e,t){for(var r=[],n=this.getDependentLayerIndices(e),a=(0,f.Z)(n,2),i=a[0],o=a[1],s=this.getDependentLayer(e),u=i;u<o;u++){Array.isArray(this.ml.images)?(-1===t||t>this.ml.images.length)&&(t=this.ml.images.length-1):t=1;for(var c=0;c<t;c++){var l=this.getBImageName(c,t),h=new v(e.getImageByName(l),s[u]);r.push(h)}}return r}}]),r}(w),I=function(e){(0,m.Z)(r,e);var t=d(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,a.Z)((0,h.Z)(n),"start",void 0),(0,a.Z)((0,h.Z)(n),"end",void 0),n.start=e.start,n.end=e.end,n}return(0,l.Z)(r,[{key:"buildLayer",value:function(e,t){var r=[],n=this.getDependentLayer(e);if(!this.start||!this.end)throw new Error("can not find start or end config for ".concat(this.ml.name));if(!this.ml.image)throw new Error("can not find image for ".concat(this.ml.name));var a=e.getImageByName(this.ml.image),i=n[this.getIndex(e,this.start.index)],o=n[this.getIndex(e,this.end.index)],s=new v(a,i),u=new v(a,o);r.push(s);for(var f=(u.x-s.x)/(t-1),c=(u.y-s.y)/(t-1),l=1;l<t;l++){var h=new v(a,i);h.move(f*l,c*l),r.push(h)}return r}}]),r}(w);function O(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var N=function(){function e(t,r,n){(0,c.Z)(this,e),this.iSrc=t,this.manifest=r,(0,a.Z)(this,"baseLayerName",void 0),(0,a.Z)(this,"layerBuilders",void 0),(0,a.Z)(this,"layers",void 0),(0,a.Z)(this,"config",void 0),this.manifest=r,this.layerBuilders=new Map,this.baseLayerName="";var i,o=O(this.manifest.layers);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=p.from(s);this.layerBuilders.set(u.name,u),this.baseLayerName||"base"!==s.mode||(this.baseLayerName=u.name)}}catch(m){o.e(m)}finally{o.f()}if(!this.baseLayerName)throw new Error("can not find base layer");this.layers=new Map,this.config=new Map;var f,l=O(n);try{for(l.s();!(f=l.n()).done;){var h=f.value;this.config.set(h.layerName,h)}}catch(m){l.e(m)}finally{l.f()}}return(0,l.Z)(e,[{key:"getImageByName",value:function(e){return this.iSrc.getImageByName(e)}},{key:"resolveLayer",value:function(e){var t=this.config.get(e);if(!t)throw new Error("Cannot find config for ".concat(e));var r=this.layerBuilders.get(e);if(!r)throw new Error("Cannot find layer builder for ".concat(e));var n=this.layers.get(e);if(n)return n;var a=r.buildLayer(this,t.number);return this.layers.set(e,a),a}},{key:"draw",value:function(e){this.resolveLayer(this.baseLayerName);var t,r=O(this.config.keys());try{for(r.s();!(t=r.n()).done;){var n=t.value;this.resolveLayer(n)}}catch(c){r.e(c)}finally{r.f()}var a=this.calculateImageSize(),i=(0,f.Z)(a,2),o=i[0],s=i[1];e.width=o,e.height=s;var u=e.getContext("2d");u&&this.drawLayerImpl(u)}},{key:"calculateImageSize",value:function(){var e,t=0,r=0,n=0,a=0,i=O(this.layers.values());try{for(i.s();!(e=i.n()).done;){var o,s=O(e.value);try{for(s.s();!(o=s.n()).done;){var u=o.value;t=Math.min(t,u.x),r=Math.min(r,u.y),n=Math.max(n,u.x2),a=Math.max(a,u.y2)}}catch(m){s.e(m)}finally{s.f()}}}catch(m){i.e(m)}finally{i.f()}var f,c=O(this.layers.values());try{for(c.s();!(f=c.n()).done;){var l,h=O(f.value);try{for(h.s();!(l=h.n()).done;){l.value.move(-t,-r)}}catch(m){h.e(m)}finally{h.f()}}}catch(m){c.e(m)}finally{c.f()}return[n-t,a-r]}},{key:"drawLayerImpl",value:function(e){var t,r=O(this.manifest.order);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("successive"==n.type){var a,i=O(n.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=this.layers.get(o);if(s){var u,f=O(s);try{for(f.s();!(u=f.n()).done;){var c=u.value;c.bImage.image&&e.drawImage(c.bImage.image,c.x,c.y)}}catch(p){f.e(p)}finally{f.f()}}}}catch(p){i.e(p)}finally{i.f()}}else if("alternate"===n.type){var l=this.layers.get(n.layers[0]);if(l)for(var h=0;h<l.length;h++){var m,y=O(n.layers);try{for(y.s();!(m=y.n()).done;){var g=m.value,v=this.layers.get(g);if(v&&!(v.length<=h)){var d=v[h];d.bImage.image&&e.drawImage(d.bImage.image,d.x,d.y)}}}catch(p){y.e(p)}finally{y.f()}}}}}catch(p){r.e(p)}finally{r.f()}}}]),e}(),L=function(){function e(t){var r=t.name,n=t.src,i=t.relative;(0,c.Z)(this,e),(0,a.Z)(this,"name",void 0),(0,a.Z)(this,"src",void 0),(0,a.Z)(this,"relative",void 0),(0,a.Z)(this,"image",void 0),this.name=r,this.src=n,i&&(this.relative=new Map(Object.entries(i)))}return(0,l.Z)(e,[{key:"loadImage",value:function(){var e=(0,s.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.files[this.src].async("blob");case 2:r=e.sent,this.image=new Image,this.image.src=URL.createObjectURL(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function S(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A=function(){function e(t,r){(0,c.Z)(this,e),(0,a.Z)(this,"images",void 0),(0,a.Z)(this,"zip",void 0),this.images=[];var n,i=S(t.images);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=new L(o);this.images.push(s)}}catch(u){i.e(u)}finally{i.f()}this.zip=r}return(0,l.Z)(e,[{key:"loadAll",value:function(){var e,t=[],r=S(this.images);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.loadImage(this.zip))}}catch(a){r.e(a)}finally{r.f()}return Promise.all(t)}},{key:"getImageByName",value:function(e){var t=this.images.find((function(t){return t.name===e}));if(t)return t;throw new Error('can not find image with name "'.concat(e,'"'))}}]),e}(),B=r(9999);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function M(e){var t,r=e.layers,a=e.config,i=e.updateConfig,o=[],s=P(r);try{var f=function(){var e,r=t.value,n={name:r.name,mode:null!==(e=r.mode)&&void 0!==e?e:"match",number:0},i=a.find((function(e){return e.layerName===r.name}));if("base"===n.mode||"repeat"===n.mode)n=D(D({},n),{},{number:i?i.number:1});else if("match"===n.mode)n=D(D({},n),{},{number:i?i.number:1});else{if("decorate"!==n.mode)throw new Error("Can not parse layer config mode ".concat(n.mode));n=D(D({},n),{},{number:i?i.number:1,min:0,max:r.images&&Array.isArray(r.images)?r.images.length:1})}o.push(n)};for(s.s();!(t=s.n()).done;)f()}catch(y){s.e(y)}finally{s.f()}var c=(0,u.useState)({configs:o}),l=c[0],h=c[1];function m(e){var t=(0,B.Z)(l.configs),r=e.target,n=r.getAttribute("data-layer-name"),a=t.find((function(e){return e.name===n}));a&&(a.number=Number(r.value)),h({configs:t})}return(0,u.useEffect)((function(){var e,t=[],r=P(l.configs);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push({layerName:n.name,number:n.number})}}catch(y){r.e(y)}finally{r.f()}i(t)}),[l.configs]),(0,n.jsx)("div",{children:l.configs.map((function(e,t){return(0,n.jsxs)("div",{children:[e.name,(0,n.jsx)("input",{type:"number","data-layer-name":e.name,value:e.number,onChange:m,min:0})]},t)}))})}var _=r(5733),R=r.n(_);function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function U(){var e=(0,u.useState)({loaded:!1,config:[]}),t=e[0],r=e[1],a=(0,u.createRef)(),i=function(){var e=(0,s.Z)(o().mark((function e(t){var n,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.files||!t.target.files.length){e.next=19;break}return r({loaded:!1,config:[]}),e.next=4,R().loadAsync(t.target.files[0]);case 4:return n=e.sent,e.t0=JSON,e.next=8,n.files["manifest.json"].async("string");case 8:return e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),e.t2=JSON,e.next=13,n.files["recomends.json"].async("string");case 13:return e.t3=e.sent,i=e.t2.parse.call(e.t2,e.t3),s=new A(a,n),e.next=18,s.loadAll();case 18:r({config:i,imageSource:s,manifest:a,loaded:!0});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){if(t.imageSource&&t.manifest){var e=new N(t.imageSource,t.manifest,t.config);a.current&&e.draw(a.current)}}),[a,t.imageSource,t.manifest,t.config]),(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"file",onChange:i}),t.manifest&&(0,n.jsx)(M,{layers:t.manifest.layers,config:t.config,updateConfig:function(e){r(T(T({},t),{},{config:e}))}}),(0,n.jsx)("canvas",{ref:a,style:{width:"100%"}})]})}var $=function(){return(0,n.jsx)(U,{})}},5301:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(7541)}])}},function(e){e.O(0,[774,224,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);